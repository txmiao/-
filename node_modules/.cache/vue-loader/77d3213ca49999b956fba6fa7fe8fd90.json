{"remainingRequest":"C:\\Users\\Administrator\\yh\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Administrator\\yh\\src\\views\\permission-manage\\resources-list.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\Administrator\\yh\\src\\views\\permission-manage\\resources-list.vue","mtime":1563516240908},{"path":"C:\\Users\\Administrator\\yh\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\yh\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\yh\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\yh\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport { deleteResources, updateResources, createResources, topresourcesList, resourcesList, } from '@/api/permission-manage'\nimport Pagination from '@/components/Pagination' // secondary package based on el-pagination\nimport waves from '@/directive/waves' // waves directive\n\nexport default {\n  name: 'ComplexTable',\n  components: { Pagination },\n  directives: { waves },\n  filters: {\n    statusFilter(status) {\n      const statusMap = {\n        published: 'success',\n        draft: 'info',\n        deleted: 'danger'\n      }\n      return statusMap[status]\n    },\n    typeFilter(type) {\n      return calendarTypeKeyValue[type]\n    }\n  },\n  data() {\n    return {\n      tableKey: 0,\n      list: null,\n      plist: null,\n      total: 0,\n      listLoading: true,\n      listQuery: {\n        page: 1,\n        limit: 10,\n        // importance: undefined,\n        _kw: undefined,\n        // type: undefined,\n        _t: 'name'\n      },\n      importanceOptions: [1, 2, 3],\n      sortOptions: [{ label: '资源名称', key: 'name' }, { label: '资源链接', key: 'link' }],\n      statusOptions: ['published', 'draft', 'deleted'],\n      showReviewer: false,\n      temp: {\n        name: '',\n        pid: ''\n      },\n      dialogFormVisible: false,\n      showTopresources: false,\n      dialogStatus: '',\n      textMap: {\n        update: '编辑',\n        create: '新增'\n      },\n      dialogPvVisible: false,\n      pvData: [],\n      rules: {\n        name: [{ required: true, message: '资源名称必填', trigger: 'blur' }],\n        sort: [{ type: 'number', message: '资源排序须为数字值' }, { required: true, message: '资源排序必填', trigger: 'blur' }]\n      },\n      downloadLoading: false\n    }\n  },\n  created() {\n    this.getList()\n    this.topmenuList()\n  },\n  methods: {\n    getList() {\n      this.listLoading = true\n      resourcesList(this.listQuery).then(response => {\n        this.list = response.data.data\n        this.total = response.data.total\n        // Just to simulate the time of the request\n        setTimeout(() => {\n          this.listLoading = false\n        }, 1.5 * 1000)\n      })\n    },\n    topmenuList() {\n      topresourcesList().then(response => {\n        this.plist = response.data\n      })\n    },\n    handleFilter() {\n      this.listQuery.page = 1\n      this.getList()\n    },\n    inLink() {\n      if (this.temp.pid == 0) {\n        this.showTopresources = false\n      } else {\n        this.showTopresources = true\n      }\n    },\n    handleModifyStatus({ $index, row }) {\n\n      this.$confirm('确定删除此资源吗?', '删除提示', {\n        confirmButtonText: '确认',\n        cancelButtonText: '取消',\n        type: 'warning'\n      })\n        .then(async() => {\n          await deleteResources(row.id)\n          this.list.splice($index, 1)\n          this.$message({\n            type: 'success',\n            message: '删除成功!'\n          })\n        })\n        .catch(err => {\n          console.error(err)\n        })\n    },\n    sortChange(data) {\n      const { prop, order } = data\n      if (prop === 'id') {\n        this.sortByID(order)\n      }\n    },\n    sortByID(order) {\n      if (order === 'ascending') {\n        this.listQuery.sort = '+id'\n      } else {\n        this.listQuery.sort = '-id'\n      }\n      this.handleFilter()\n    },\n    resetTemp() {\n      this.temp = {\n        name: '',\n        pid: 0\n      }\n    },\n    handleCreate() {\n      this.resetTemp()\n      this.dialogStatus = 'create'\n      this.dialogFormVisible = true\n      this.$nextTick(() => {\n        this.$refs['dataForm'].clearValidate()\n      })\n    },\n    createData() {\n      this.$refs['dataForm'].validate((valid) => {\n        if (valid) {\n          createResources(this.temp).then(response => {\n            this.temp.id = response.data.id\n            this.temp.belongs_to_parent = response.data.belongs_to_parent\n            var str = response.data.created_at.date\n            var s1 = str.substring(0, str.length - 7)\n            this.temp.created_at = s1\n            this.list.unshift(this.temp)\n            this.dialogFormVisible = false\n            // this.getList()\n            this.$notify({\n              title: '资源',\n              message: '增加资源成功',\n              type: 'success',\n              duration: 2000\n            })\n          }).catch(err => {\n            console.log(err)\n          })\n        }\n      })\n    },\n    handleUpdate(scope) {\n\n      this.temp = Object.assign({}, scope.row) // copy obj\n      // this.temp.timestamp = new Date(this.temp.timestamp)\n      this.dialogStatus = 'update'\n      this.dialogFormVisible = true\n      this.$nextTick(() => {\n        this.$refs['dataForm'].clearValidate()\n      })\n    },\n    updateData() {\n      this.$refs['dataForm'].validate((valid) => {\n        if (valid) {\n          const tempData = Object.assign({}, this.temp)\n          this.$delete(tempData, 'created_at')\n          updateResources(tempData).then(() => {\n            for (const v of this.list) {\n              if (v.id === this.temp.id) {\n                const index = this.list.indexOf(v)\n                this.list.splice(index, 1, this.temp)\n                break\n              }\n            }\n            this.dialogFormVisible = false\n            this.$notify({\n              title: '权限',\n              message: '编辑权限成功',\n              type: 'success',\n              duration: 2000\n            })\n          })\n        }\n      })\n    },\n    handleDelete(row) {\n      this.$notify({\n        title: 'Success',\n        message: 'Delete Successfully',\n        type: 'success',\n        duration: 2000\n      })\n      const index = this.list.indexOf(row)\n      this.list.splice(index, 1)\n    }\n  }\n}\n",null]}