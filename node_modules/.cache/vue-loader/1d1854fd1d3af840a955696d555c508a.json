{"remainingRequest":"C:\\Users\\Administrator\\yh\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Administrator\\yh\\src\\views\\permission-manage\\role-list.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\Administrator\\yh\\src\\views\\permission-manage\\role-list.vue","mtime":1563461882111},{"path":"C:\\Users\\Administrator\\yh\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\yh\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\yh\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\yh\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {\n  deleteRole,\n  updateRole,\n  checkedPermission,\n  createRole,\n  getPermissionlist,\n  getRoles,\n  permissionList,\n  createPermission,\n  updatePermission,\n  deletePermission\n} from '@/api/permission-manage'\nimport Pagination from '@/components/Pagination' // secondary package based on el-pagination\nimport waves from '@/directive/waves' // waves directive\n\nexport default {\n  name: 'ComplexTable',\n  components: { Pagination },\n  directives: { waves },\n  filters: {\n    statusFilter(status) {\n      const statusMap = {\n        published: 'success',\n        draft: 'info',\n        deleted: 'danger'\n      }\n      return statusMap[status]\n    },\n    typeFilter(type) {\n      return calendarTypeKeyValue[type]\n    }\n  },\n  data() {\n    return {\n      checked: [],\n      checkList: [],\n      tableKey: 0,\n      list: null,\n      total: 0,\n      listLoading: true,\n      listQuery: {\n        page: 1,\n        limit: 10\n      },\n      importanceOptions: [1, 2, 3],\n\n      sortOptions: [{ label: '权限', key: 'name' }, { label: '名称', key: 'display_name' }],\n      statusOptions: ['published', 'draft', 'deleted'],\n      showReviewer: false,\n      temp: {\n        name: '',\n        display_name: '',\n        description: ''\n      },\n      dialogFormVisible: false,\n      dialogStatus: '',\n      textMap: {\n        update: '编辑',\n        create: '新增'\n      },\n      dialogPvVisible: false,\n      pvData: [],\n      rules: {\n        name: [{ required: true, message: '权限必填', trigger: 'blur' }],\n        display_name: [{ required: true, message: '权限名称必填', trigger: 'blur' }],\n        description: [{ required: true, message: '权限描述必填', trigger: 'blur' }]\n      },\n      downloadLoading: false\n    }\n  },\n  created() {\n    this.getList()\n    this.permissionList()\n  },\n  methods: {\n    test() {\n      console.log(this.checked)\n      this.temp.perm_id = this.checked\n    },\n    async permissionList() {\n      const res = await getPermissionlist()\n      this.checkList = res.data\n    },\n    getList() {\n      this.listLoading = true\n      getRoles(this.listQuery).then(response => {\n        this.list = response.data.data\n        this.total = response.data.total\n\n        // Just to simulate the time of the request\n        setTimeout(() => {\n          this.listLoading = false\n        }, 1.5 * 1000)\n      })\n    },\n    handleFilter() {\n      this.listQuery.page = 1\n      this.getList()\n    },\n    handleModifyStatus({ $index, row }) {\n\n      this.$confirm('确定删除此角色吗?', '删除提示', {\n        confirmButtonText: '确认',\n        cancelButtonText: '取消',\n        type: 'warning'\n      })\n        .then(async() => {\n          await deleteRole(row.id)\n          this.list.splice($index, 1)\n          this.$message({\n            type: 'success',\n            message: '删除成功!'\n          })\n        })\n        .catch(err => {\n          console.error(err)\n        })\n    },\n    sortChange(data) {\n      const { prop, order } = data\n      if (prop === 'id') {\n        this.sortByID(order)\n      }\n    },\n    sortByID(order) {\n      if (order === 'ascending') {\n        this.listQuery.sort = '+id'\n      } else {\n        this.listQuery.sort = '-id'\n      }\n      this.handleFilter()\n    },\n    resetTemp() {\n      this.temp = {\n        name: '',\n        display_name: '',\n        description: ''\n      }\n    },\n    handleCreate() {\n      this.checked = []\n      this.resetTemp()\n      this.dialogStatus = 'create'\n      this.dialogFormVisible = true\n      this.$nextTick(() => {\n        this.$refs['dataForm'].clearValidate()\n      })\n    },\n    createData() {\n      this.$refs['dataForm'].validate((valid) => {\n        if (valid) {\n          createRole(this.temp).then(response => {\n            this.temp.id = response.data.id\n            this.list.unshift(this.temp)\n            this.dialogFormVisible = false\n            this.checked = []\n            this.$notify({\n              title: '角色',\n              message: '增加角色成功',\n              type: 'success',\n              duration: 2000\n            })\n          })\n        }\n      })\n    },\n    handleUpdate(scope) {\n      // console.log(row.id)\n      // console.log(JSON.stringify(row))\n      this.temp = Object.assign({}, scope.row) // copy obj\n      // this.temp.timestamp = new Date(this.temp.timestamp)\n      checkedPermission(scope.row.id).then(response => {\n        this.checked = response.data\n\n      })\n      this.dialogStatus = 'update'\n      this.dialogFormVisible = true\n      this.$nextTick(() => {\n        this.$refs['dataForm'].clearValidate()\n      })\n    },\n    updateData() {\n      this.$refs['dataForm'].validate((valid) => {\n        if (valid) {\n          const tempData = Object.assign({}, this.temp)\n          this.$delete(tempData, 'created_at')\n          updateRole(tempData).then(() => {\n            for (const v of this.list) {\n              if (v.id === this.temp.id) {\n                const index = this.list.indexOf(v)\n                this.list.splice(index, 1, this.temp)\n                break\n              }\n            }\n            this.dialogFormVisible = false\n            this.$notify({\n              title: '权限',\n              message: '编辑权限成功',\n              type: 'success',\n              duration: 2000\n            })\n          })\n        }\n      })\n    },\n    handleDelete(row) {\n      this.$notify({\n        title: 'Success',\n        message: 'Delete Successfully',\n        type: 'success',\n        duration: 2000\n      })\n      const index = this.list.indexOf(row)\n      this.list.splice(index, 1)\n    }\n  }\n}\n",null]}