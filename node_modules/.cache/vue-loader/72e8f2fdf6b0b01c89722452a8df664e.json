{"remainingRequest":"C:\\Users\\Administrator\\yuanhang\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Administrator\\yuanhang\\src\\views\\article-manage\\article-list.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\Administrator\\yuanhang\\src\\views\\article-manage\\article-list.vue","mtime":1563714008424},{"path":"C:\\Users\\Administrator\\yuanhang\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\yuanhang\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\yuanhang\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\yuanhang\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {\n  getCategoryList,\n  articleList,\n  createArticle,\n  updatePermission,\n  deleteArticle\n} from '@/api/article-manage'\nimport Pagination from '@/components/Pagination' // secondary package based on el-pagination\nimport waves from '@/directive/waves' // waves directive\nimport Tinymce from '@/components/Tinymce'\n\nexport default {\n  name: 'ComplexTable',\n  components: { Pagination, Tinymce },\n  directives: { waves },\n  filters: {\n    statusFilter(status) {\n      const statusMap = {\n        published: 'success',\n        draft: 'info',\n        deleted: 'danger'\n      }\n      return statusMap[status]\n    },\n    typeFilter(type) {\n      return calendarTypeKeyValue[type]\n    }\n  },\n  data() {\n    return {\n      imageUrl: '',\n      tableKey: 0,\n      list: null,\n      categorylist: null,\n      total: 0,\n      listLoading: true,\n      listQuery: {\n        page: 1,\n        limit: 10,\n        _kw: undefined,\n        _t: 'name'\n      },\n      importanceOptions: [1, 2, 3],\n\n      sortOptions: [{ label: '标题', key: 'name' }],\n      statusOptions: ['published', 'draft', 'deleted'],\n      showReviewer: false,\n      temp: {\n        is_show: 101,\n        is_top: 101,\n        category_id: '',\n        images: '',\n        content: ''\n      },\n      dialogFormVisible: false,\n      dialogStatus: '',\n      textMap: {\n        update: '编辑',\n        create: '新增'\n      },\n      dialogPvVisible: false,\n      pvData: [],\n      rules: {\n        title: [{ required: true, message: '标题必填', trigger: 'blur' }],\n        category_id: [{ required: true, message: '分类必填', trigger: 'blur' }]\n\n      },\n      downloadLoading: false\n    }\n  },\n  created() {\n    this.getList()\n    this.categoryList()\n  },\n  methods: {\n    handleAvatarSuccess(res, file) {\n      this.imageUrl = URL.createObjectURL(file.raw)\n      this.temp.images = res.data\n    },\n    beforeAvatarUpload(file) {\n      const isJPG = file.type === 'image/jpeg'\n      const isLt2M = file.size / 1024 / 1024 < 2\n\n      if (!isJPG) {\n        this.$message.error('上传头像图片只能是 JPG 格式!')\n      }\n      if (!isLt2M) {\n        this.$message.error('上传头像图片大小不能超过 2MB!')\n      }\n      return isJPG && isLt2M\n    },\n\n    categoryList() {\n      getCategoryList().then(response => {\n        this.categorylist = response.data\n      })\n    },\n    getList() {\n      this.listLoading = true\n      articleList(this.listQuery).then(response => {\n        this.list = response.data.data\n        this.total = response.data.total\n\n        // Just to simulate the time of the request\n        setTimeout(() => {\n          this.listLoading = false\n        }, 1.5 * 1000)\n      })\n    },\n    handleFilter() {\n      this.listQuery.page = 1\n      this.getList()\n    },\n    handleModifyStatus({ $index, row }) {\n\n      this.$confirm('确定删除此文章吗?', '删除提示', {\n        confirmButtonText: '确认',\n        cancelButtonText: '取消',\n        type: 'warning'\n      })\n        .then(async() => {\n          await deleteArticle(row.id)\n          this.list.splice($index, 1)\n          this.$message({\n            type: 'success',\n            message: '删除成功!'\n          })\n        })\n        .catch(err => {\n          console.error(err)\n        })\n    },\n    sortChange(data) {\n      const { prop, order } = data\n      if (prop === 'id') {\n        this.sortByID(order)\n      }\n    },\n    sortByID(order) {\n      if (order === 'ascending') {\n        this.listQuery.sort = '+id'\n      } else {\n        this.listQuery.sort = '-id'\n      }\n      this.handleFilter()\n    },\n    resetTemp() {\n      this.imageUrl = ''\n      this.temp = {\n        is_show: 101,\n        is_top: 101,\n        content: ''\n\n      }\n    },\n    handleCreate() {\n      this.resetTemp()\n      this.dialogStatus = 'create'\n      this.dialogFormVisible = true\n      this.$nextTick(() => {\n        this.$refs['dataForm'].clearValidate()\n      })\n    },\n    createData() {\n      this.$refs['dataForm'].validate((valid) => {\n        if (valid) {\n          createArticle(this.temp).then(response => {\n            this.temp.id = response.data.id\n            var str = response.data.created_at.date\n            var s1 = str.substring(0, str.length - 7)\n            this.temp.created_at = s1\n            this.temp.category_name = response.data.cat_name\n            this.list.unshift(this.temp)\n            this.dialogFormVisible = false\n            this.$notify({\n              title: '文章',\n              message: '增加文章成功',\n              type: 'success',\n              duration: 2000\n            })\n          })\n        }\n      })\n    },\n    handleUpdate(scope) {\n\n      this.temp = Object.assign({}, scope.row) // copy obj\n      console.log(JSON.stringify(this.temp))\n\n      this.imageUrl = this.temp.thumbnail\n      // this.temp.timestamp = new Date(this.temp.timestamp)\n      this.dialogStatus = 'update'\n      this.dialogFormVisible = true\n      this.$nextTick(() => {\n        this.$refs['dataForm'].clearValidate()\n      })\n    },\n    updateData() {\n      this.$refs['dataForm'].validate((valid) => {\n        if (valid) {\n          const tempData = Object.assign({}, this.temp)\n          this.$delete(tempData, 'created_at')\n          updatePermission(tempData).then(() => {\n            for (const v of this.list) {\n              if (v.id === this.temp.id) {\n                const index = this.list.indexOf(v)\n                this.list.splice(index, 1, this.temp)\n                break\n              }\n            }\n            this.dialogFormVisible = false\n            this.$notify({\n              title: '权限',\n              message: '编辑权限成功',\n              type: 'success',\n              duration: 2000\n            })\n          })\n        }\n      })\n    },\n    handleDelete(row) {\n      this.$notify({\n        title: 'Success',\n        message: 'Delete Successfully',\n        type: 'success',\n        duration: 2000\n      })\n      const index = this.list.indexOf(row)\n      this.list.splice(index, 1)\n    }\n  }\n}\n",null]}